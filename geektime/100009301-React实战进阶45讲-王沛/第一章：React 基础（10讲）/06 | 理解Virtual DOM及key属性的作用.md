JSX 的运行基础：Virtual DOM

当时做 2 个 tree 之间的 diff，标准的算法复杂度是 O(n**3)。

而 React 利用虚拟 DOM 计算，算法复杂度是 O(n)。

虚拟 DOM 是如何工作的，如何计算 diff？

1. 广度优先分层比较。拿到 2 个 DOM 树，一层一层地比较
2. 从根节点开始比较
3. 属性变化及顺序
4. 节点类型发生变化（把旧的节点完全删了，创建新的节点）
5. 节点跨层移动（在原来的地方把旧的节点完全删了，在新的地方创建新的节点）

看上去很消耗性能，其实不会。因为实际开发中，DOM 结构是相对稳定的，很少发生「节点跨层移动」，React 舍弃了这一部分的检查是合理的，带来了整体的性能提升。

虚拟 DOM 的两个假设：

1. 组件的 DOM 结构是相对稳定的
2. 类型相同的兄弟节点可以被唯一标识（key 属性，提高性能的属性）

React 分别对 tree diff、component diff 以及 element diff 进行算法优化

总结：

1. React 通过制定大胆的 diff 策略，将 O(n3) 复杂度的问题转换成 O(n) 复杂度的问题；
2. React 通过分层求异的策略，对 tree diff 进行算法优化；
3. React 通过相同类生成相似树形结构，不同类生成不同树形结构的策略，对 component diff 进行算法优化；
4. React 通过设置唯一 key 的策略，对 element diff 进行算法优化；
5. 建议，在开发组件时，保持稳定的 DOM 结构会有助于性能的提升；
6. 建议，在开发过程中，尽量减少类似将最后一个节点移动到列表首部的操作，当节点数量过大或更新操作过于频繁时，在一定程度上会影响 React 的渲染性能。

<https://zhuanlan.zhihu.com/p/20346379>
